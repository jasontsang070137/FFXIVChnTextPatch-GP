buildscript {
	ext {
		kotlinVersion = '1.3.11'
		springBootVersion = '2.1.0.RELEASE'
	}
	repositories {
		maven { url "https://maven.aliyun.com/nexus/content/groups/public/" }
		maven { url "https://repo.spring.io/milestone" }
		mavenCentral()
	}
	dependencies {
		classpath("org.springframework.boot:spring-boot-gradle-plugin:${springBootVersion}")
		classpath("org.jetbrains.kotlin:kotlin-gradle-plugin:${kotlinVersion}")
		classpath("org.jetbrains.kotlin:kotlin-allopen:${kotlinVersion}")
	}
}

apply plugin: 'idea'
apply plugin: 'java'
apply plugin: 'application'

sourceSets {
    main {
        java.srcDir('src/main/java')
		resources.srcDir('src/main/resources')
		java.destinationDirectory.set(file('build/bin'))
		output.resourcesDir = file('build/bin')
    }
}

compileJava {
	sourceCompatibility = 1.8
	targetCompatibility = 1.8
}

repositories {
	maven { url "https://maven.aliyun.com/nexus/content/groups/public/" }
	maven { url "https://repo.spring.io/milestone" }
	mavenCentral()
}

dependencies {
	testImplementation(
        'junit:junit:4.12'
    )
	implementation("com.jcraft:jzlib:1.1.3")
	implementation("org.nlpcn:nlp-lang:1.7.6")
	implementation("com.google.code.gson:gson:2.8.5")
	implementation("commons-codec:commons-codec:1.11")
	implementation("org.apache.httpcomponents:httpcore:4.4.6")
	implementation("org.apache.httpcomponents:httpclient:4.5.3")
	implementation("org.apache.httpcomponents:httpclient-cache:4.5.3")
	implementation("org.apache.httpcomponents:httpmime:4.5.3")
	implementation("org.apache.httpcomponents:fluent-hc:4.5.3")
	implementation(files("lib/univocity-parsers-2.9.1.jar"))
}

mainClassName = "name.yumao.ffxiv.chn.FFXIVPatchMain"

jar {
	manifest {
		attributes(
				'Main-Class': 'org.eclipse.jdt.internal.jarinjarloader.JarRsrcLoader',
				'Class-Path': './ ' + configurations.runtimeClasspath.collect { it.getName() }.join(' '),
				'Rsrc-Main-Class': mainClassName,
		)
	}
	from {
		// zip compile jar
		configurations.runtimeClasspath.collect { it }
		// zip extra compile jar
		// configurations.runtimeClasspath.collect { it.isDirectory() ? it : zipTree(it) }
	}
}

task copyLibs(type: Copy) {
	from configurations.runtimeClasspath
	from 'lib'
	into 'build/lib'
}

tasks.withType(GroovyCompile) {
	groovyOptions.encoding = "MacRoman"
}

tasks.withType(JavaCompile) {
	options.encoding = "UTF-8"
}